<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>ESC V1</title>
</head>
<body>
  
<link rel="stylesheet" href=/css/style.css>


<div class="wrapper">

<header>
  <h1><a href="/">Savo's Site</a></h1>
</header>

<nav>
<div class="flex-container">

<div class="navbutton"><a href="/about-me/">About Me</a></div>
<div class="dropdown">
	<a href="/projects/">Projects</a>
	<div class="dropdown-content">
		<a href="/projects/academic/">Academic</a>
		<a href="/projects/extracurricular/">Extracurricular</a>
		<a href="/projects/personal/">Personal</a>
		<a href="/projects/work/">Work</a>
	</div>
</div>
<div class="navbutton"><a href="/publications/">Publications</a></div>
<div class="navbutton"><a href="/work-experience/">Employment</a></div>
<div class="navbutton"><a href="/volunteering/">Volunteering</a></div>
<div class="navbutton"><a href="/contact/">Contact</a></div>

<div>
</nav>


<ul class="breadcrumbs">
    <li class="breadcrumbs"><a class="subtitle" href="/">Home</a></li>
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects">Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal">Personal Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal/esc">Drone ESC</a></li>
            		    
				        <li class="breadcrumbs"><a class="subtitle" href="/projects/personal/esc/esc-v1">ESC V1</a></li></ul>



	
	<main>
	<section class="mainIntro">
  



	<h1>ESC V1</h1>
	<div class="introLine"></div>
	<div class="subtitle"><strong>Last Modified:</strong> Monday, Jan 24, 2022</div>
	<div class="subtitle"><strong>Status:</strong> Assembled, Never Used</div>

	
		<div class="subtitle"><strong>Period:</strong> May 2020 - May 2020</div>
	

	
	

	<div class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/drone">drone</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> <a href="/tags/kicad">KiCAD</a> </div>

	<div class="introLine"></div>

 


  </section>

  <section class="mainContent">
  <h1 id="overview">Overview</h1>
<p>I decided to try and make my own quad-rotor drone from scratch to give myself a large project. One component of this
is to make the <em>Electronic Speed Controller (ESC)</em> used for the rotors.</p>
<p>This design is based on ELECTRONOOB&rsquo;s work with his <a href="http://electronoobs.com/eng_arduino_tut91.php">open-source ESC</a>.
This first version of my ESC was basically a replica of his work.</p>
<p>Although I designed the system and <em>[almost]</em> assembled a board, I never actually did anything with them beyond that because
it was just a warm up for my second version and beyond.</p>
<h2 id="takeaways">Takeaways</h2>
<ul>
<li>This board was quite large and would barely fit on the frame I ordered. So I needed to shrink it down.</li>
</ul>
<h1 id="detailed-report">Detailed Report</h1>
<p>I was looking for an interesting project to bite into that would be both fun for me and cool to show off, even to
non-technically inclined people (such as my mother), so I decided to try and make my own quad-rotor drone from scratch.
As many would have you believe, the motors need to be accurately controlled for it to stay in the air.</p>
<h2 id="circuit-design">Circuit Design</h2>
<p>I started this design based on ELECTRONOOB&rsquo;s work with his <a href="http://electronoobs.com/eng_arduino_tut91.php">first ESC</a>
but primarily his <a href="https://youtu.be/-ymTE-Nivzw">third version</a>. This first version of my ESC was largely a replica
of his work, with only a few tweaks related to the MOSFETs and the driver I selected.</p>
<p>The circuit design was basically taken from his first version, with the modifications made to basically feature match his
third version. This meant removing the parts related to the USB and the buzzer. In addition some parts relating to the
MOSFETs were changed to ones I could readily find.</p>
<figure>
<img src="/images/esc-v1-schematic.svg">
<figcaption>The completed schematic for the ESC V1 (PDF version: <a href="/pdf/ESC_V1.pdf">Colour</a> / <a href="/pdf/ESC_V1_BW.pdf">BW</a>)</figcaption>
</figure>
<h3 id="brains">Brains</h3>
<p>The heart of the system is the ATmega328P, in the TQFP-32 form of Arduino Nano fame. This chip is responsible for all the
control of the system, it will receive commands over PWM or I2C and direct the MOSFET driver accordingly. It is also used
for detecting the zero-crossings using the internal comparator and some external resistor arrays to divide the voltages
from the motors down to a safe level for the Atmega328P as well as averaging them for a &ldquo;zero&rdquo;. It is configured to be
programmable using a generic serial programmer from the like of FTDI like a normal Arduino Nano.</p>
<p>There are a set of solder jumpers to be used to configure the ESC without needing to reprogram it: the default rotation
can be reversed with a jumper, and the I2C address the ATmega will take.</p>
<h3 id="inverter-motor-control">Inverter (Motor Control)</h3>
<p>Motor control is handed by a three phase inverter made of <a href="https://toshiba.semicon-storage.com/us/semiconductor/product/mosfets/12v-300v-mosfets/detail.TPN2R903PL.html">TPN2R903PL</a>
N-channel MOSFETs, driven by a single <a href="https://www.onsemi.com/products/power-management/gate-drivers/fan7888">FAN7888</a>
MOSFET driver IC that receives control signals from the ATmega.</p>
<p>N-channel MOSFETs are used on both sides of the bridge due to their lower &ldquo;on&rdquo; resistance. To drive the high-side FETs
requires &ldquo;bootstrapping&rdquo; to get a gate voltage higher than the drain (VBAT) for optimal performance. This process is
handled by the FAN7888 and a capacitor and diode for each phase (D1-D3, C2-C4), resistors are recommended but not required
(RN3).</p>
<p><em>Bootstrapping</em> in this application is the process of changing a capacitor between ground and the supply voltage, then
disconnecting it on both ends. Then connecting the capacitor terminal that was previously connected to ground, to the supply
rail. Since the potential across the capacitor has not been changed, the potential at the positive side is now twice that of
the supply rail relative to ground. This is then routed to drive the gate of the high side MOSFETs. <em>The FAN7888 does not
actually switch the connections on the low side of the bootstrapping capacitor</em>, it has that constantly connected to the
source of the MOSFETs (phase output), but it achieves the same effect and is useful for a few other reasons such as avoiding
potentially exceeding the gate-source voltage.</p>
<h3 id="5v-regulator-battery-elimination-circuit">5V Regulator (Battery Elimination Circuit)</h3>
<p>A 5V buck regulator is used to supply the microcontroller with power from the battery input. Although the individual draw of
the microcontroller on the ESC is well within what could be reasonably provided by a linear regulator, thus saving space on
the board and reducing system cost, I decided to use the buck regulator to allow the 5V from an ESC to be used as a common
rail to <em>efficiently</em> power other drone systems instead having to design a 5V regulator into each.</p>
<h2 id="board-layout">Board Layout</h2>
<p>I laid out the circuit on a board that I arbitrarily set to be 65mm x 35mm. In order to decrease the size I had the output
stage of the circuit on one side and the remainder of the electronics on the other. All power lines are t be soldered on
their designated pads/exposed traces. Along the right edge of the figures there is a large exposed pad for the two power
rails, this was done to easily allow the soldering of buffer capacitors along this edge as needed.</p>
<figure>
<img src="/images/esc-v1-combined-layout.png">
<figcaption>The overall layout of the board</figcaption>
</figure>
<p>The output stage was put all on one side for simplicity and because given the powerful nature of the components, they were
generally bulkier, as well as the traces. I designed all the power traces to be 5mm wide to carry upwards of 10A without
exceeding a 20Â°C rise in temperature with 1oz. copper (~35um) (on the drone they will be positioned under the propellors
which should aid with cooling. In addition to their width, I exposed the power traces to allow easier soldering of wires
to them as well flooding them with solder to increase their current capacities.</p>
<figure>
<img src="/images/esc-v1-top-layout.png">
<figcaption>The layout of the output stage side</figcaption>
</figure>
<p>The remainder of the system (control and voltage regulator) were housed on one shared side. The 5V buck regulator was nested
between the ground and +5V pads on the left part of the board, with distinct thicker traces for the power into and out of it
to carry the up to 1A at 5V without issue. The remainder of the side was used for the control part of the system.</p>
<figure>
<img src="/images/esc-v1-bottom-layout.png">
<figcaption>The layout of the control and voltage regulator side</figcaption>
</figure>
<h2 id="assembly">Assembly</h2>
<p>Assembly wasn&rsquo;t too notable, other than being my first set of SMT board to have components on both sides. This required me
to prop up the edges of the board so it would not be resting on the components and be level for when I was applying the
solder paste using the stencil. Since I was ordering and assembling V1 and V2 of the ESCs and Flight Computers together,
I ordered a stencil that had a portion for each of them.</p>
<figure>
<img src="/images/esc-v1-mcu-side.jpg">
<figcaption>The assembled control and voltage regulator side</figcaption>
</figure>
<figure>
<img src="/images/esc-v1-mosfet-side.jpg">
<figcaption>The assembled MOSFET/Inverter side (Note: I removed the MOSFET driver to use on other boards)</figcaption>
</figure>
<figure>
<img src="/images/drone-shared-stencil.jpg">
<figcaption>The combined stencil for the EWSC and flight computers V1s and V2s</figcaption>
</figure>
<p>One thing I did mess up during assembly is when ordering the resistor arrays I accidentally ordered the wrong size -
<em>twice</em>. This is partially why I never tested these boards, although I could have easily fit through-hole resistors in their
place like I did with my <a href="/projects/personal/gameboi">gameBOI</a>.</p>

  </section>
  </main>
  
  <footer>
     <a href="http://savobajic.ca/">Savo Bajic's Website</a>
</footer>
</div>

</body>
</html>
