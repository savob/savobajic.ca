<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>Drone ESC</title>
</head>
<body>
	
<link rel="stylesheet" href=/css/style.css>


<div class="wrapper">

<header>
  <h1><a href="/">Savo's Site</a></h1>
</header>

<nav>
<div class="flex-container">

<div class="navbutton"><a href="/about-me/">About Me</a></div>
<div class="dropdown">
	<a href="/projects/">Projects</a>
	<div class="dropdown-content">
		<a href="/projects/academic/">Academic</a>
		<a href="/projects/extracurricular/">Extracurricular</a>
		<a href="/projects/personal/">Personal</a>
		<a href="/projects/work/">Work</a>
	</div>
</div>
<div class="navbutton"><a href="/publications/">Publications</a></div>
<div class="navbutton"><a href="/work-experience/">Employment</a></div>
<div class="navbutton"><a href="/volunteering/">Volunteering</a></div>
<div class="navbutton"><a href="/contact/">Contact</a></div>

<div>
</nav>


<ul class="breadcrumbs">
    <li class="breadcrumbs"><a class="subtitle" href="/">Home</a></li>
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects">Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal">Personal Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal/esc">Drone ESC</a></li>
            		    
				        </ul>



	
	<main>
	
	<h1 id="overview-of-the-esc-project">Overview of the ESC Project</h1>
<p>I decided to try and make my own quad-rotor drone from scratch to give myself a large project. One component of this
is to make the <em>Electronic Speed Controller (ESC)</em> used for the each rotor&rsquo;s motor.</p>
<p>My designs were originally based on ELECTRONOOB&rsquo;s work with his <a href="http://electronoobs.com/eng_arduino_tut91.php">open-source ESC</a>.
This first three versions of my ESC was basically a replica of his hardware. With the fourth onward, the hardware is completely
my own.</p>
<p>Most of my software development for features was done with my second version. Initially I intended to use
<a href="http://electronoobs.com/eng_arduino_tut91_code1.php">ELECTRONOOB&rsquo;s code</a> however I needed to change it to match my hardware
design and I noticed it wasn&rsquo;t commuting the motor correctly, so I ultimately decided to re-write most of it from scratch.</p>
<p>When I moved to my fourth revision I needed to re-write much of my code again because I made extensive use of hardware
and registers that were different between the two microcontrollers.</p>
<p><strong><em>Current Status:</em> I am currently waiting to order and assemble my fifth revision boards to continue developing their firmware.</strong></p>
<h2 id="requirements">Requirements</h2>
<ul>
<li>Operate with supply voltages between 9V and 20V</li>
<li>Be able to supply 30A continuously</li>
<li>Allow control over I2C</li>
</ul>
<h2 id="objectives">Objectives</h2>
<ul>
<li>PWM control</li>
<li>RPM control feature (over I2C)</li>
<li>Allow data to be extracted over I2C (e.g. current duty cycle)</li>
</ul>
<h2 id="takeaways">Takeaways</h2>
<ul>
<li>Mixed voltages and power levels need special considerations</li>
<li>Having the right hardware capabilities goes a long way</li>
</ul>
<h1 id="motor-theory">Motor Theory</h1>
<p>Although I wouldn&rsquo;t describe myself a great teacher, I will try my best to provide a basic overview of brush-less DC
motor control theory.</p>
<p>An electric motor generally uses a set of permanent magnets and electrified coils to generate rotary motion. As current
flows through a coil, a magnetic field is generated, this magnetic field will induce a force (torque) on the coil as it
tries to align itself with the ambient magnetic field produced by the permanent magnets. Just before the fields reach
alignment (and thus no more force will be imparted on the motor), the current is commutated so the fields generated are
no longer about to align and the force continues to be imparted on the motor shaft. This cycle repeats as long as the
motor is operating. The rotating assemble in the motor is called the <em>rotor</em>, the stationary assembly the <em>stator</em>.</p>
<figure>
<img src="/images/esc-dc-motor-gif.gif">
<figcaption>An animation of a brushed DC motor. Courtesy of <a href="https://cecas.clemson.edu/cvel/auto/actuators/motors-dc-brushed.html">CVEL</a></figcaption>
</figure>
<p>Basic DC motors use mechanical commutation methods like the brushes in the animation above. The motors used in most
quad-copters, especially for high performance drones, are brush-less DC motors which are constructed differently and need
a special controller to operate properly, generally called Electronic Speed Controllers (ESC). Their more complicated
operation is a trade off for significantly increased power density, vital for flight.</p>
<p>Instead of having the coils attached to the rotating shaft to induce force on it due to the fixed ambient field from the
permanent magnets, they reverse this setup and have the motors on the shaft and windings stationary. Thus no brushes are
present and the motors are instead controlled using a three phase scheme. To do this the voltage on one of the wires must
pulled low, and high on another, while the third one is disconnected from either extreme. The supply of power must be
quickly and reliably changed to generate the needed rotation. This supply of power and commutation timing is what is
handled by the ESC.</p>
<figure>
<img src="/images/esc-bldc-motor.gif">
<figcaption>An animation of a brush-less DC motor. Courtesy of <a href="https://www.embitel.com/blog/embedded-blog/brushless-dc-motor-vs-pmsm-how-these-motors-and-motor-control-solutions-work">embitel</a></figcaption>
</figure>
<p>Since most motors used on drones are meant to be compact and cheap, they usually lack any sensors on them to aid the
controller in properly knowing the position of the rotor, thus when it is optimal to commutate. However, there is a trick
that can be employed to derive the position of the rotor! Due to the generally rapid rotation of the rotor, there is a
<strong>back electro-motive force (BEMF)</strong> exerted on the coils in the stator, which can be monitored using the disconnected
phase of the motor.</p>
<p>When disconnected from power the voltage on a phase will start at the voltage it was last supplied, as the rotor rotates
the voltage will gradually change to approach the other extreme at which point it will need to switch to that supply.</p>
<figure>
<img src="/images/esc-bldc-timing-chart.png">
<figcaption>Timing chart showing a basic BLDC rotation with the voltage on (dotted line) and current through (solid) each phase marked. Figure 9 of <a href="https://www.ti.com/lit/an/sprabq7a/sprabq7a.pdf?ts=1642166596205">TI Application Report SPRABQ7A</a></figcaption>
</figure>
<p>One generally finds it easiest to use the moment the voltage on this disconnected phase crosses the average voltage of all
phases (also called the &ldquo;zero&rdquo; voltage) using a comparator to know when the rotor is halfway through the step and time the
next commutation based on the time elapsed since the most recent phase change to reach that midpoint-crossing.</p>
<h1 id="list-of-versions">List of Versions</h1>
<p>This project has been very iterative, and I have made a page for each revision to explain the intent of it and details
related to it the main ones of interest being V2 and V4.</p>

	
	
	
		

<div class="row">
<div class="column">




	<a href="https://savobajic.ca/projects/personal/esc/esc-v5/">
	<article>
	
	
	
		<img class="thumbnail" src="/images/esc-v5-combined-layout.png">
	
	
	

<h2 class=listEntry>
	<a href="https://savobajic.ca/projects/personal/esc/esc-v5/">ESC V5</a>
</h2>





	<p class="subtitle">Status: Designed, waiting for boards to arrive</p>
	
	
	<p class="subtitle">Started: August 2021</p>
	
	
	
	  <p class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/drone">drone</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> </p>
	









<p class="listEntry">Newest revision to the ESC. Largely designed to use the available MOSFET drivers.</p>

	
	
	
		
	</article>
	</a>
	
	


	<a href="https://savobajic.ca/projects/personal/esc/esc-v4/">
	<article>
	
	
	
		<img class="thumbnail" src="/images/esc-v4-assembled-bottom.jpg">
	
	
	

<h2 class=listEntry>
	<a href="https://savobajic.ca/projects/personal/esc/esc-v4/">ESC V4</a>
</h2>





	<p class="subtitle">Status: Testing, on Pause</p>
	
	
	<p class="subtitle">Period: September 2020 - August 2021</p>
	
	
	
	  <p class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/drone">drone</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> </p>
	









<p class="listEntry">Another major revision to the BLDC ESC, mainly changing to the modern ATtiny family of microcontrollers.</p>

	
	
	
		
	</article>
	</a>
	
	


	<a href="https://savobajic.ca/projects/personal/esc/esc-v3/">
	<article>
	
	
	
		<img class="thumbnail" src="/images/esc-v3-top-assembled.jpg">
	
	
	

<h2 class=listEntry>
	<a href="https://savobajic.ca/projects/personal/esc/esc-v3/">ESC V3</a>
</h2>





	<p class="subtitle">Status: Complete, Never Assembled</p>
	
	
	<p class="subtitle">Period: August 2020 - September 2020</p>
	
	
	
	  <p class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/drone">drone</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> </p>
	









<p class="listEntry">A revision of ESV V2 with the voltage regulator removed</p>

	
	
	
		
	</article>
	</a>
	
	
  	</div> 
  	<div class="column">
	


	<a href="https://savobajic.ca/projects/personal/esc/esc-v2/">
	<article>
	
	
	
		<img class="thumbnail" src="/images/esc-v2-top-assembled.jpg">
	
	
	

<h2 class=listEntry>
	<a href="https://savobajic.ca/projects/personal/esc/esc-v2/">ESC V2</a>
</h2>





	<p class="subtitle">Status: Complete</p>
	
	
	<p class="subtitle">Period: May 2020 - September 2020</p>
	
	
	
	  <p class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> <a href="/tags/kicad">KiCAD</a> </p>
	









<p class="listEntry">My first <em>actual attempt</em> at building an ESC. A shrunk down revision of the first.</p>

	
	
	
		
	</article>
	</a>
	
	


	<a href="https://savobajic.ca/projects/personal/esc/esc-v1/">
	<article>
	
	
	
		<img class="thumbnail" src="/images/esc-v1-mcu-side.jpg">
	
	
	

<h2 class=listEntry>
	<a href="https://savobajic.ca/projects/personal/esc/esc-v1/">ESC V1</a>
</h2>





	<p class="subtitle">Status: Assembled, Never Used</p>
	
	
	<p class="subtitle">Period: May 2020 - May 2020</p>
	
	
	
	  <p class="subtitle"><strong>Tags:</strong> <a href="/tags/bldc">BLDC</a> <a href="/tags/drone">drone</a> <a href="/tags/embedded">embedded</a> <a href="/tags/esc">ESC</a> <a href="/tags/kicad">KiCAD</a> </p>
	









<p class="listEntry">My first attempt to make a sensor-less ESC for my drone</p>

	
	
	
		
	</article>
	</a>
	
	

</div>
</div>

	
	</main>
	
	<footer>
     <a href="http://savobajic.ca/">Savo Bajic's Website</a>
</footer>
</div>

</body>
</html>
