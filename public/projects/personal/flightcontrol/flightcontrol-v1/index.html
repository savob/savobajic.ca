<!DOCTYPE html>
<html>
<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <meta http-equiv="X-UA-Compatible" content="ie=edge">
     <title>Flight Controller V1</title>
</head>
<body>
  
<link rel="stylesheet" href=/css/style.css>


<div class="wrapper">

<header>
  <h1><a href="/">Savo's Site</a></h1>
</header>

<nav>
<div class="flex-container">

<div class="navbutton"><a href="/about-me/">About Me</a></div>
<div class="dropdown">
	<a href="/projects/">Projects</a>
	<div class="dropdown-content">
		<a href="/projects/academic/">Academic</a>
		<a href="/projects/extracurricular/">Extracurricular</a>
		<a href="/projects/personal/">Personal</a>
		<a href="/projects/work/">Work</a>
	</div>
</div>
<div class="navbutton"><a href="/publications/">Publications</a></div>
<div class="navbutton"><a href="/work-experience/">Employment</a></div>
<div class="navbutton"><a href="/volunteering/">Volunteering</a></div>
<div class="navbutton"><a href="/contact/">Contact</a></div>

<div>
</nav>


<ul class="breadcrumbs">
    <li class="breadcrumbs"><a class="subtitle" href="/">Home</a></li>
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects">Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal">Personal Projects</a></li>
            		    
				        
                
                    
            		 	      <li class="breadcrumbs"><a class="subtitle" href="/projects/personal/flightcontrol">Drone Flight Controller</a></li>
            		    
				        <li class="breadcrumbs"><a class="subtitle" href="/projects/personal/flightcontrol/flightcontrol-v1">Flight Controller V1</a></li></ul>



	
	<main>
	<section class="mainIntro">
  



	<h1>Flight Controller V1</h1>
	<div class="introLine"></div>
	<div class="subtitle"><strong>Last Modified:</strong> Wednesday, Jan 26, 2022</div>
	<div class="subtitle"><strong>Status:</strong> Assembled. Not planning on using.</div>

	
		<div class="subtitle"><strong>Period:</strong> May 2020 - May 2020</div>
	

	
	

	<div class="subtitle"><strong>Tags:</strong> <a href="/tags/drone">drone</a> <a href="/tags/imu">imu</a> </div>

	<div class="introLine"></div>

 


  </section>

  <section class="mainContent">
  <h1 id="overview">Overview</h1>
<p>My first design of a flight controller for my custom drone, based principally around and ATmega328P so it could be easily
adapted to use open source efforts in drone control like ArduPilot which are based around common hobbyist chips like
this one (from the Arduino Uno and Nano).</p>
<p>The hardware design was pretty simple and I had no issues with assembly and passing basic tests.</p>
<p>I have not yet bothered to code for this as it is a back up to the more powerful V2 which I have not needed to give up on.</p>
<h2 id="requirements">Requirements</h2>
<p><em>In addition to the general ones outlined for all flight controllers:</em></p>
<ul>
<li>Use the ATmega328P microcontroller as the heart of the system</li>
</ul>
<h2 id="takeaways">Takeaways</h2>
<ul>
<li>Was a built in voltage regulator necessary?</li>
</ul>
<h1 id="detailed-report">Detailed Report</h1>
<p>This was my first attempt to make a flight computer, unlike the ESC where I started working off someone else&rsquo;s design, I
truly started from scratch here, other than using the standard ATmega328P setup for Arduinos. I decided to base this one
around that specific microcontroller to ensure greater compatibility with other efforts in flight controller software if I
eventually tried to use them instead of potentially having to port their code to the less common STM32.</p>
<p>The hardware side of designing this was simpler than expected once I had selected my sensors, since I was basically just
slapping together three ICs and some voltage regulators on an board. There were no considerations needed for high power
or transients beyond decoupling capacitors because it was a low power board.</p>
<p>The real meat of this project would be the code. However I never intended to focus on the development of this board since
it is meant to be a backup to the more powerful V2. So beyond verifying everything worked as intended on the board, I never
bothered to code for it.</p>
<h2 id="circuit-design">Circuit Design</h2>
<p>Since the main purpose of this board is to shuffle around data I made sure to prioritize the hardware bus pins on the
ATmega328P for this purpose. Other than that there honestly weren&rsquo;t too many design choices I needed to make beyond selecting
my exact ICs for each purpose since I simply used the recommended reference design for each segment of the circuit.</p>
<p>The only exception being the level shifter, which although a standard reference design, I needed to select the exact MOSFETs
to use for the job.</p>
<figure>
<img src="/images/flight-controller-v1-schematic.svg">
<figcaption>The completed schematic for the flight controller V1 (PDF version: <a href="/pdf/flight-controller-V1.pdf">Colour</a> / <a href="/pdf/flight-controller-V1-BW.pdf">BW</a>)</figcaption>
</figure>
<p>There isn&rsquo;t much unique electronically about this board compared to the outline I had for the the flight controllers in general.</p>
<h2 id="layout">Layout</h2>
<p>The layout of this board was done on a two layered, 36mm by 36mm board. Much like the layout of the
<a href="/projects/personal/esc/esc-v1/#board-layout">first ESC</a> I had one side focused on all the control electronics and the other
where all the power related electronics resided. I had placed mounting holes in the corners to fasten it properly to the drone.</p>
<figure>
<img src="/images/flight-controller-v1-combined-layout.png">
<figcaption>The overall layout of the board</figcaption>
</figure>
<p>For the control side I figured that placing the ATmega in the centre would help ease routing so most traces would fan out of
it and thus less wonky routing would be needed. Along the left is where the sensors sit, the bottom is the connection to the
nRF24 module, the right has the spare inputs/outputs, and the top has the headers for programming and I2C for the ESCs.</p>
<figure>
<img src="/images/flight-controller-v1-top-layout.png">
<figcaption>The layout of the control side</figcaption>
</figure>
<p>The rear is where the pours were made for the ESCs to tap into the battery power from a common bus. Sandwiched between these
pours were the two dedicated voltage regulators for the board producing 5V and 3.3V with moderate current capacity so no need
for thick traces.</p>
<figure>
<img src="/images/flight-controller-v1-bottom-layout.png">
<figcaption>The layout of the power and voltage regulator side</figcaption>
</figure>
<h2 id="assembly">Assembly</h2>
<p>Assembly was simple and I faced no issues.</p>
<figure>
<img src="/images/flight-controller-v1-top-assembled.jpg">
<figcaption>The top side of the assembled board</figcaption>
</figure>
<figure>
<img src="/images/flight-controller-v1-bottom-assembled.jpg">
<figcaption>The bottom side of the assembled board (Note: the 3.3V regulator was removed for use in another board)</figcaption>
</figure>
<h2 id="testing">Testing</h2>
<p>I checked for shorts between adjacent pins with a multimeter as well as power lines, then I applied power and verified
that the regulators were also working as expected, producing a steady 5V and 3.3V. I then left the system powered for a
few minutes to monitor current draw and ensure none of the ICs were getting warm, which they didn&rsquo;t.</p>
<p>After the basic power tests were done I was able to burn the bootloader on the ATmega328P to program it over Serial like a
normal Arduino without issue. Other than a basic I2C bus scan to check the sensors were responsive, nothing has been done
with the board.</p>

  </section>
  </main>
  
  <footer>
     <a href="http://savobajic.ca/">Savo Bajic's Website</a>
</footer>
</div>

</body>
</html>
